(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-2fcec0bf"],{3045:function(t,e,s){},"46c0":function(t,e,s){"use strict";s.r(e);var o=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"container"},[s("topNav",{staticClass:"topNav",attrs:{title:t.title,isleftarrow:t.isleftarrow}}),t.isNeedLogistics?[t.defaultAddress.linkMan?s("div",{staticClass:"address-box mb10",on:{click:t.onAddressChoose}},[s("div",{staticClass:"address-box-hd"},[s("div",{staticClass:"address-box-inner"},[s("van-icon",{staticClass:"address-box-inner-icon",attrs:{name:"location-o"}}),s("div",{staticClass:"address-box-inner-title"},[t._v("收货人："+t._s(t.defaultAddress.linkMan))]),s("div",{staticClass:"address-box-inner-title"},[t._v(t._s(t.defaultAddress.mobile))])],1),s("div",{staticClass:"address-box-inner-bottom"},[t._v("收货地址："+t._s(t.defaultAddress.address))])]),s("div",{staticClass:"address-box-bd"},[s("van-icon",{attrs:{name:"arrow"}})],1)]):s("van-contact-card",{attrs:{type:"add","add-text":"添加地址"},on:{click:t.onAddressChoose}})]:t._e(),t.goodsInfo.length?s("div",{staticClass:"main"},[s("div",{staticClass:"group balance-group"},t._l(t.goodsInfo,(function(t,e){return s("van-card",{key:t.id,attrs:{num:t.selectedNum,price:t.price,desc:t.propTitle,title:t.name,thumb:t.pic}})})),1),s("van-cell-group",[s("van-cell",{attrs:{"is-link":"",value:"选择"},scopedSlots:t._u([{key:"title",fn:function(){return[s("van-icon",{staticClass:"icon-logistics",attrs:{name:"logistics"}}),s("span",{staticClass:"custom-title"},[t._v("配送方式")])]},proxy:!0}],null,!1,457227271)})],1),s("van-cell-group",[s("van-field",{staticClass:"mb10",attrs:{label:"买家留言",type:"textarea",placeholder:"点击给商家留言",rows:"1",autosize:""},model:{value:t.remark,callback:function(e){t.remark=e},expression:"remark"}})],1)],1):t._e(),s("van-submit-bar",{attrs:{price:t._f("formatPoint")(t.totalPrice),"button-text":"提交订单"},on:{submit:t.onSubmit}})],2)},a=[],i=(s("4de4"),s("c975"),s("d81d"),s("13d5"),s("b680"),s("ac1f"),s("5319"),s("5530")),r=s("d072"),n=s("ebd8"),d=s("be3b");function c(t,e){return d["a"].post("/order/pay",{orderId:t,token:e})}var l=s("2f62"),u={data:function(){return{goodsId:[],list:[],title:"",isleftarrow:"",checkedGoods:[],remark:"",chosenCoupon:-1,coupons:[],disabledCoupons:[],showList:!1,isNeedLogistics:!0,hasDiscount:!1,goodsInfo:[],isBalancePay:!0,balance:0,expireMinutes:60,marketing:{}}},components:{topNav:n["a"]},created:function(){if("buy"===this.$route.query.type)this.goodsInfo=sessionStorage.get("buyInfo")||[],this.marketing=this.goodsInfo[0].marketing;else{var t=r["a"].storage.get("cartInfo"),e=this.$route.query.checkedGoods||[];t=e.length?t.filter((function(t){return-1!==e.indexOf(t.id)})):t,this.goodsInfo=t}this.getDefaultAddress(),this.getUserAmount(),this.marketing.type&&(this.expireMinutes=0),this.marketing.type},mounted:function(){this.title=this.$route.meta.title,this.isleftarrow=this.$route.meta.isleftarrow},computed:Object(i["a"])(Object(i["a"])({},Object(l["c"])(["defaultAddress"])),{},{totalPrice:function(){var t=this.goodsInfo.reduce((function(t,e){return t+e.selectedNum*e.price}),0);return console.log(parseFloat(t.toFixed(2))),t>0?parseFloat(t.toFixed(2)):(0).toFixed(2)}}),filters:{formatPoint:function(t){return parseFloat((100*t).toFixed(2))}},methods:Object(i["a"])(Object(i["a"])({},Object(l["b"])(["updateDefaultAddress"])),{},{getDefaultAddress:function(){var t=this;this.$request.get("/user/shipping-address/default",{token:r["a"].storage.get("token")}).then((function(e){t.updateDefaultAddress(e.data||{})}))},getUserAmount:function(){var t=this;this.$request.get("/user/amount",{token:r["a"].storage.get("token")}).then((function(e){0===e.code&&(t.balance=e.data.balance)}))},onAddressChoose:function(){this.$router.push({path:"/address-list",query:{isChoose:!0}})},onSubmit:function(){if(this.defaultAddress.linkMan){this.$toast.loading({mask:!0,message:"订单创建中",duration:0}),console.log(this.goodsInfo);var t=this.goodsInfo.map((function(t){return{goodsId:t.goodsId,number:t.selectedNum,propertyChildIds:t.propertyChildIds,logisticsType:0}}));console.log(JSON.stringify(t));var e={token:r["a"].storage.get("token"),goodsJsonStr:JSON.stringify(t),calculate:!1,expireMinutes:this.expireMinutes,peisongType:"kd",remark:this.remark,address:this.defaultAddress.address,provinceId:this.defaultAddress.provinceId,cityId:this.defaultAddress.cityId,code:this.defaultAddress.code,linkMan:this.defaultAddress.linkMan,mobile:this.defaultAddress.mobile};this.createOrder(e)}else this.$toast({message:"地址栏不能为空",duration:1500})},createOrder:function(t){var e=this;console.log(t),this.$request.post("/order/create",t).then((function(t){if(console.log("创建订单",t),0===t.code){e.$toast.clear();var s=t.data;e.onPay(s)}else e.$toast(t.msg)}))},onPay:function(t){var e=this;console.log(t);var s=t.id,o=t.amountReal,a=this.goodsInfo[0].goodsId;console.log(s,o,a),this.isBalancePay?this.$dialog.confirm({title:"提示",message:"确认提交订单？"}).then((function(){e.$toast.loading({mask:!0,message:"支付提交中",duration:1e3}),c(s,r["a"].storage.get("token")).then((function(t){console.log("支付结果",t),0===t.code?(e.$toast.clear(),e.removeStorageGoods(),e.$router.push({path:"/order-detail?id="+s})):e.$toast(t.msg)}))})).catch((function(){})):(this.removeStorageGoods(),this.$router.replace({path:"/order-list?status=0"}))},removeStorageGoods:function(){if("buy"===this.$route.query.type)sessionStorage.remove("buyInfo");else{var t=r["a"].storage.get("cartInfo"),e=this.$route.query.checkedGoods||[];t=e.length?t.filter((function(t){return!(-1!==e.indexOf(t.id))})):t,r["a"].storage.set("cartInfo",t)}}})},f=u,h=(s("b324"),s("2877")),g=Object(h["a"])(f,o,a,!1,null,"7439fcba",null);e["default"]=g.exports},7864:function(t,e,s){"use strict";s("3045")},b21c:function(t,e,s){},b324:function(t,e,s){"use strict";s("b21c")},ebd8:function(t,e,s){"use strict";var o=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{attrs:{id:"NavBar"}},[s("van-nav-bar",{attrs:{title:t.title,"left-text":"返回","left-arrow":t.isleftarrow},on:{"click-left":t.onClickLeft}})],1)},a=[],i={props:["title","isleftarrow"],methods:{onClickLeft:function(){this.$router.go(-1)}}},r=i,n=(s("7864"),s("2877")),d=Object(n["a"])(r,o,a,!1,null,"591cede4",null);e["a"]=d.exports}}]);
//# sourceMappingURL=chunk-2fcec0bf.897e5b00.js.map